<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="preload" as="font" href="https://ritiek.github.io/fonts/vendor/jost/jost-v4-latin-regular.woff2" type="font/woff2" crossorigin>
  <link rel="preload" as="font" href="https://ritiek.github.io/fonts/vendor/jost/jost-v4-latin-700.woff2"  type="font/woff2" crossorigin>


<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&family=PT+Sans:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://ritiek.github.io/main.css?v=1761474498">
<link rel="stylesheet" href="https://ritiek.github.io/custom.css?v=1761474498">



  
  
  
  
  
    
  

  
  
    
    
  
  
  
    
  
  
  
  
    
  
  
  


  <meta name="robots" content="index, follow">
  <meta name="googlebot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
  <meta name="bingbot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">


	


	

<title>NixOS on Radxa Zero 3W | Ritiek Malhotra</title>
<meta name="description" content="Just some of my adventures!">
<link rel="canonical" href="https://ritiek.github.io/2025/03/27/nixos-on-radxa-zero-3w/">


  <meta name="twitter:card" content="summary_large_image">
  
  <meta name="twitter:title" content="NixOS on Radxa Zero 3W">
  <meta name="twitter:description" content="Just some of my adventures!">
  <meta name="twitter:site" content="@">
  <meta name="twitter:creator" content="@">
  
  <meta property="og:title" content="NixOS on Radxa Zero 3W">
  <meta property="og:description" content="Just some of my adventures!">
  <meta property="og:type" content="article">
  <meta property="og:url" content="https://ritiek.github.io/2025/03/27/nixos-on-radxa-zero-3w/">

  

  <meta property="og:updated_time" content="">
  <meta property="og:site_name" content="NixOS on Radxa Zero 3W">

  

  

  
  <meta property="article:publisher" content="https://www.facebook.com/">
  <meta property="article:author" content="https://www.facebook.com/">
  <meta property="og:locale" content="en_US">









<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BreadcrumbList",
    
      
      
        
        
        
        
        
        
        
        
          {
            "@type": "ListItem",
            "position":  1 ,
            "name": "Home",
            "item": "https://ritiek.github.io/"
          },
          
          
          {
            "@type": "ListItem",
            "position":  2 ,
            "name": "2025",
            "item": "https://ritiek.github.io/2025/"
          },
        
      
        
        
        
        
        
        
        
        
          
          
          {
            "@type": "ListItem",
            "position":  3 ,
            "name": "03",
            "item": "https://ritiek.github.io/2025/03/"
          },
        
      
        
        
        
        
        
        
        
        
          
          
          {
            "@type": "ListItem",
            "position":  4 ,
            "name": "27",
            "item": "https://ritiek.github.io/2025/03/27/"
          },
        
      
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
          
          
          {
            "@type": "ListItem",
            "position":  5 ,
            "name": "Nixos On Radxa Zero 3w",
            "item": "https://ritiek.github.io/2025/03/27/nixos-on-radxa-zero-3w/"
          },
        
      
    
  }
</script>







  <meta name="theme-color" content="#fff">
  <link rel="apple-touch-icon" sizes="180x180" href="https://ritiek.github.io/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="https://ritiek.github.io/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://ritiek.github.io/favicon-16x16.png">
  
    <link rel="manifest" href="https://ritiek.github.io/site.webmanifest" crossorigin>
  


  

</head>

  

<body class="blog single">
  
  
<div class="header-bar fixed-top"></div>
<header class="navbar fixed-top navbar-expand-md navbar-light">
	<div class="container">
		<input class="menu-btn order-0" type="checkbox" id="menu-btn">
		<label class="menu-icon d-md-none" for="menu-btn"><span class="navicon"></span></label>
		<a class="navbar-brand order-1 order-md-0 me-auto" href="https://ritiek.github.io">Ritiek Malhotra</a>
		<button id="mode" class="btn btn-link order-2 order-md-4" type="button" aria-label="Toggle mode">
			<span class="toggle-dark"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg></span>
			<span class="toggle-light"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg></span>
		</button>
		<ul class="navbar-nav fork-me order-3 order-md-5">
			
				
					<li class="nav-item">
						<a class="nav-link" href="https://github.com/ritiek"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg><span class="ms-2 visually-hidden">GitHub</span></a>
					</li>
				
			
		</ul>
		<div class="collapse navbar-collapse order-4 order-md-1">
			<ul class="navbar-nav main-nav me-auto order-5 order-md-2">
				
					
				
				
				
					
						<li class="nav-item">
							<a class="nav-link" href="/posts/">Archive</a>
						</li>
					
						<li class="nav-item">
							<a class="nav-link" href="/about/">About</a>
						</li>
					
				
			</ul>
			<div class="break order-6 d-md-none"></div>
			
				<form class="navbar-form flex-grow-1 order-7 order-md-3">
					<input id="userinput" class="form-control is-search" type="search" placeholder="Search posts..."
						aria-label="Search posts..." autocomplete="off">
					<div id="suggestions" class="shadow bg-white rounded"></div>
				</form>
			
		</div>
	</div>

</header>



  
<div class="wrap container" role="document">
  <div class="content">
    <div class="row justify-content-center">
      <div class="col-md-12 col-lg-10 col-xxl-8">
        <article>
          <div class="blog-header">
            <h1>NixOS on Radxa Zero 3W</h1>
            
<p><small>27 Mar 2025</small><p>

          </div>
          
          <p>I was able to get NixOS working on Radxa Zero 3W! It's got some firmware related issues, with
the major one being built-in WiFi not getting detected correctly. Otherwise, it seems usable for
the most part.</p>
<h2 id="tl-dr">TL;DR</h2>
<p>NixOS SD card images can be build using this flake:
<a href="https://github.com/nabam/nixos-rockchip">https://github.com/nabam/nixos-rockchip</a></p>
<p>Use the image for <code>CM3/CM3 I/O</code> board type.</p>
<!-- TODO: I think the reason this probably works is.. (See boot source code (at home)). -->
<p>Basically, add the inputs to our flake.nix:</p>
<pre data-lang="nix" style="background-color:#2b303b;color:#c0c5ce;" class="language-nix "><code class="language-nix" data-lang="nix"><span style="color:#bf616a;">inputs </span><span style="background-color:#bf616a;color:#2b303b;">=</span><span> {
</span><span>  </span><span style="color:#d08770;">rockchip</span><span>.</span><span style="color:#d08770;">url </span><span>= &quot;</span><span style="color:#a3be8c;">github:nabam/nixos-rockchip</span><span>&quot;;
</span><span>  </span><span style="color:#d08770;">flake-utils</span><span>.</span><span style="color:#d08770;">url </span><span>= &quot;</span><span style="color:#a3be8c;">github:numtide/flake-utils</span><span>&quot;;
</span><span>}</span><span style="background-color:#bf616a;color:#2b303b;">;</span><span>
</span></code></pre>
<p>Define the target outputs in flake.nix</p>
<pre data-lang="nix" style="background-color:#2b303b;color:#c0c5ce;" class="language-nix "><code class="language-nix" data-lang="nix"><span style="color:#bf616a;">nixosConfigurations</span><span>.</span><span style="color:#bf616a;">radxa-zero-3 </span><span style="background-color:#bf616a;color:#2b303b;">=</span><span> </span><span style="color:#bf616a;">inputs</span><span>.</span><span style="color:#bf616a;">nixpkgs</span><span>.</span><span style="color:#bf616a;">lib</span><span>.</span><span style="color:#bf616a;">nixosSystem </span><span>{
</span><span>  </span><span style="color:#d08770;">system </span><span>= &quot;</span><span style="color:#a3be8c;">aarch64-linux</span><span>&quot;;
</span><span>  </span><span style="color:#d08770;">modules </span><span>= [
</span><span>    </span><span style="color:#a3be8c;">./machines/radxa-zero-3
</span><span>    </span><span style="color:#a3be8c;">./machines/radxa-zero-3/hw-config.nix
</span><span>  ];
</span><span>  </span><span style="color:#d08770;">specialArgs </span><span>= { </span><span style="color:#b48ead;">inherit </span><span style="color:#d08770;">inputs</span><span>; };
</span><span>}</span><span style="background-color:#bf616a;color:#2b303b;">;</span><span>
</span><span>
</span><span style="color:#bf616a;">radxa-zero-3-sd </span><span style="background-color:#bf616a;color:#2b303b;">=</span><span> </span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#bf616a;">nixosConfigurations</span><span>.</span><span style="color:#bf616a;">radxa-zero-3</span><span>.</span><span style="color:#bf616a;">config</span><span>.</span><span style="color:#bf616a;">system</span><span>.</span><span style="color:#bf616a;">build</span><span>.</span><span style="color:#bf616a;">sdImage</span><span style="background-color:#bf616a;color:#2b303b;">;</span><span>
</span></code></pre>
<p>Add this config to the board's hardware configuration:</p>
<pre data-lang="nix" style="background-color:#2b303b;color:#c0c5ce;" class="language-nix "><code class="language-nix" data-lang="nix"><span style="color:#8fa1b3;">{ </span><span>config, lib, pkgs, modulesPath, inputs, ... </span><span style="color:#8fa1b3;">}</span><span>:
</span><span>
</span><span style="color:#b48ead;">let
</span><span>  </span><span style="color:#d08770;">noZFS </span><span>= {
</span><span>    </span><span style="color:#d08770;">inputs</span><span>.</span><span style="color:#d08770;">nixpkgs</span><span>.</span><span style="color:#d08770;">overlays </span><span>= [
</span><span>      (final: super: {
</span><span>        </span><span style="color:#d08770;">zfs </span><span>= </span><span style="color:#bf616a;">super</span><span>.</span><span style="color:#bf616a;">zfs</span><span>.</span><span style="color:#bf616a;">overrideAttrs </span><span>(_: { </span><span style="color:#d08770;">meta</span><span>.</span><span style="color:#d08770;">platforms </span><span>= [ ]; });
</span><span>      })
</span><span>    ];
</span><span>  };
</span><span style="color:#b48ead;">in
</span><span>{
</span><span>  </span><span style="color:#d08770;">imports </span><span>= [
</span><span>    </span><span style="color:#bf616a;">inputs</span><span>.</span><span style="color:#bf616a;">rockchip</span><span>.</span><span style="color:#bf616a;">nixosModules</span><span>.</span><span style="color:#bf616a;">sdImageRockchip
</span><span>    </span><span style="color:#bf616a;">inputs</span><span>.</span><span style="color:#bf616a;">rockchip</span><span>.</span><span style="color:#bf616a;">nixosModules</span><span>.</span><span style="color:#bf616a;">noZFS
</span><span>  ];
</span><span>
</span><span>  </span><span style="color:#65737e;"># I&#39;ll assume native host machine as aarch64.
</span><span>  </span><span style="color:#65737e;"># (I believe &quot;aarch64-linux&quot; can be changed to &quot;x86-64-linux&quot; to cross-compile)
</span><span>  </span><span style="color:#d08770;">rockchip</span><span>.</span><span style="color:#d08770;">uBoot </span><span>= </span><span style="color:#bf616a;">inputs</span><span>.</span><span style="color:#bf616a;">rockchip</span><span>.</span><span style="color:#bf616a;">packages</span><span>.&quot;</span><span style="color:#a3be8c;">aarch64-linux</span><span>&quot;.</span><span style="color:#bf616a;">uBootRadxaCM3IO</span><span>;
</span><span>  </span><span style="color:#d08770;">boot</span><span>.</span><span style="color:#d08770;">kernelPackages </span><span>= </span><span style="color:#bf616a;">inputs</span><span>.</span><span style="color:#bf616a;">rockchip</span><span>.</span><span style="color:#bf616a;">legacyPackages</span><span>.&quot;</span><span style="color:#a3be8c;">aarch64-linux</span><span>&quot;.</span><span style="color:#bf616a;">kernel_linux_6_12_rockchip</span><span>;
</span><span>}
</span></code></pre>
<h2 id="issues">Issues</h2>
<p>It looks like the onboard WiFi is not yet supported by the kernel shipped with the <a href="https://github.com/NixOS/nixpkgs/commit/b6eaf97c6960d97350c584de1b6dcff03c9daf42">current latest version
of NixOS unstable</a>.</p>
<p>It is important to note that early Radxa Zero 3W boards shipped with a different WiFi chip, AP6212. The
newer versions and the board I have on me come with the AIC WiFi chip. Both of these depened on a different
software driver. The AIC WiFi chip requires the AIC8800 driver.</p>
<p><a href="https://forum.radxa.com/t/wifi-driver-for-radxa-zero-3w/20507">https://forum.radxa.com/t/wifi-driver-for-radxa-zero-3w/20507</a></p>
<p>There's an open issue on nixpkgs to add support for the newer Radxa Zero 3W's onboard WiFi module:</p>
<p><a href="https://github.com/NixOS/nixpkgs/issues/342133">https://github.com/NixOS/nixpkgs/issues/342133</a></p>
<p>In the meanwhile, it's possible to feed internet to the board via USB tethering. My Android mobile device,
as well most Android devices out there support USB tethering out-of-the-box.</p>
<p>I also tried an RTL8192EU based WiFi dongle and it has been a plug-and-play experience as well.</p>
<h2 id="how-to-know-if-the-board-is-booting-into-the-os">How to know if the board is booting into the OS?</h2>
<p>I've tried out the <code>CM3/CM3 I/O</code> image variant from
<a href="https://github.com/nabam/nixos-rockchip">https://github.com/nabam/nixos-rockchip</a>
which looks to boot properly on my Radxa Zero 3W.</p>
<p>It's easy to verify whether the image is booting into the OS if we've a supported micro-HDMI cable and a
monitor around.</p>
<p>If not, there's another way to verify whether the boot sequence is working correctly. Try out the following:</p>
<ol>
<li>
<p>Flash the image onto the microSD card.</p>
</li>
<li>
<p>Mount this flashed microSD card onto your local machine first and take note of the directory structure
present in the root partition.</p>
</li>
<li>
<p>Insert this flashed SD card into Radxa Zero 3W and keep the board powered on for ~5 mins. If the boot
sequence is working as expected, the software should perform nix path registrations on the first boot.</p>
</li>
<li>
<p>Now pull out the microSD card from the board and mount it onto your local machine. If the directory
structure has changed considerably from before, and nix-path-registrations file is no longer present in the
root partition, that means the boot was a success!</p>
</li>
</ol>
<p>That is pretty much it! If you're headless, you can build a config using nixos-rockchip that launches the
OpenSSH server on boot with your credentials. You can then find the IP address of the board after tethering
and SSH'ing into the board should then work just fine.</p>
<h2 id="radxa-zero-3e">Radxa Zero 3E?</h2>
<p>I've also Radxa Zero 3E with me which doesn't seem to boot up with the Radxa CM3/CM3 I/O image (or any
other image, including the Radxa-supported Debian and Ubuntu images).
I'm not sure if I received a damaged board or that the boot addresses are different
between the 3W and the 3E. I've read people having issues with the microSD slot where the pins do not
make contact when the microSD card is inserted on the 3E, although mine seems to look good in this
regard. More tinkering imminent.</p>

        </article>
      </div>
    </div>
  </div>
</div>


  
    
<footer class="footer text-muted">
	<div class="container">
		<div class="row">
			<div class="col-lg-8 order-last order-lg-first">
				<ul class="list-inline">
					
						<li class="list-inline-item">Powered by <a href="https://www.getzola.org/">Zola</a></li>
					
				</ul>
			</div>
			<div class="col-lg-8 order-first order-lg-last text-lg-end">
				<ul class="list-inline">
					
				</ul>
			</div>
		</div>
	</div>
</footer>

  

  
<script type="text/javascript" src="https://ritiek.github.io/js/main.js" defer></script>

  <script type="text/javascript" src="https://ritiek.github.io/plugins/elasticlunr.min.js"></script>
  <script type="text/javascript">
    console.log("Loading search index...");
    fetch("https://ritiek.github.io/search_index.en.json")
      .then(response => {
        console.log("Search index response:", response.status);
        if (!response.ok) {
          throw new Error('Search index not found');
        }
        return response.json();
      })
      .then(data => { 
        console.log("Search index loaded successfully");
        window.searchIndex = data;
        var script = document.createElement('script');
        script.src = "https://ritiek.github.io/js/search.js";
        document.body.appendChild(script);
      })
      .catch(error => {
        console.error("Error loading search index:", error);
      });
  </script>

  
</body>
</html>
