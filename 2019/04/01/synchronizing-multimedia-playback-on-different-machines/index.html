<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="preload" as="font" href="https://ritiek.github.io/fonts/vendor/jost/jost-v4-latin-regular.woff2" type="font/woff2" crossorigin>
  <link rel="preload" as="font" href="https://ritiek.github.io/fonts/vendor/jost/jost-v4-latin-700.woff2"  type="font/woff2" crossorigin>


<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&family=PT+Sans:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://ritiek.github.io/main.css?v=1761433552">
<link rel="stylesheet" href="https://ritiek.github.io/custom.css?v=1761433552">



  
  
    
  

  
  
    
    
  
  
  
    
  
  
  
  
    
  
  
  

<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">

  <meta name="robots" content="index, follow">
  <meta name="googlebot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
  <meta name="bingbot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">


	


	

<title>Synchronizing multimedia playback on different machines | Ritiek Malhotra</title>
<meta name="description" content="Just some of my adventures!">
<link rel="canonical" href="https://ritiek.github.io/2019/04/01/synchronizing-multimedia-playback-on-different-machines/">


  <meta name="twitter:card" content="summary_large_image">
  
  <meta name="twitter:title" content="Synchronizing multimedia playback on different machines">
  <meta name="twitter:description" content="Just some of my adventures!">
  <meta name="twitter:site" content="@">
  <meta name="twitter:creator" content="@">
  
  <meta property="og:title" content="Synchronizing multimedia playback on different machines">
  <meta property="og:description" content="Just some of my adventures!">
  <meta property="og:type" content="article">
  <meta property="og:url" content="https://ritiek.github.io/2019/04/01/synchronizing-multimedia-playback-on-different-machines/">

  

  <meta property="og:updated_time" content="">
  <meta property="og:site_name" content="Synchronizing multimedia playback on different machines">

  

  

  
  <meta property="article:publisher" content="https://www.facebook.com/">
  <meta property="article:author" content="https://www.facebook.com/">
  <meta property="og:locale" content="en_US">









<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BreadcrumbList",
    
      
      
        
        
        
        
        
        
        
        
          {
            "@type": "ListItem",
            "position":  1 ,
            "name": "Home",
            "item": "https://ritiek.github.io/"
          },
          
          
          {
            "@type": "ListItem",
            "position":  2 ,
            "name": "2019",
            "item": "https://ritiek.github.io/2019/"
          },
        
      
        
        
        
        
        
        
        
        
          
          
          {
            "@type": "ListItem",
            "position":  3 ,
            "name": "04",
            "item": "https://ritiek.github.io/2019/04/"
          },
        
      
        
        
        
        
        
        
        
        
          
          
          {
            "@type": "ListItem",
            "position":  4 ,
            "name": "01",
            "item": "https://ritiek.github.io/2019/04/01/"
          },
        
      
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
          
          
          {
            "@type": "ListItem",
            "position":  5 ,
            "name": "Synchronizing Multimedia Playback On Different Machines",
            "item": "https://ritiek.github.io/2019/04/01/synchronizing-multimedia-playback-on-different-machines/"
          },
        
      
    
  }
</script>






  <meta name="theme-color" content="#fff">
  <link rel="apple-touch-icon" sizes="180x180" href="https://ritiek.github.io/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="https://ritiek.github.io/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://ritiek.github.io/favicon-16x16.png">
  
    <link rel="manifest" href="https://ritiek.github.io/site.webmanifest" crossorigin>
  


  

</head>

  
    
  

<body class="page single">
  
    
<div class="header-bar fixed-top"></div>
<header class="navbar fixed-top navbar-expand-md navbar-light">
	<div class="container">
		<input class="menu-btn order-0" type="checkbox" id="menu-btn">
		<label class="menu-icon d-md-none" for="menu-btn"><span class="navicon"></span></label>
		<a class="navbar-brand order-1 order-md-0 me-auto" href="https://ritiek.github.io">Ritiek Malhotra</a>
		<button id="mode" class="btn btn-link order-2 order-md-4" type="button" aria-label="Toggle mode">
			<span class="toggle-dark"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg></span>
			<span class="toggle-light"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg></span>
		</button>
		<ul class="navbar-nav fork-me order-3 order-md-5">
			
				
					<li class="nav-item">
						<a class="nav-link" href="https://github.com/ritiek"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg><span class="ms-2 visually-hidden">GitHub</span></a>
					</li>
				
			
		</ul>
		<div class="collapse navbar-collapse order-4 order-md-1">
			<ul class="navbar-nav main-nav me-auto order-5 order-md-2">
				
					
				
				
				
					
						<li class="nav-item">
							<a class="nav-link" href="/posts/">Archive</a>
						</li>
					
						<li class="nav-item">
							<a class="nav-link" href="/about/">About</a>
						</li>
					
				
			</ul>
			<div class="break order-6 d-md-none"></div>
			
				<form class="navbar-form flex-grow-1 order-7 order-md-3">
					<input id="userinput" class="form-control is-search" type="search" placeholder="Search posts..."
						aria-label="Search posts..." autocomplete="off">
					<div id="suggestions" class="shadow bg-white rounded"></div>
				</form>
			
		</div>
	</div>

</header>

  

  
<div class="wrap container" role="document">
  <div class="content">
    <div class="row justify-content-center">
      <div class="col-md-12 col-lg-10 col-xxl-8">
        <article>
          <div class="page-header">
            <h1>Synchronizing multimedia playback on different machines</h1>
          </div>
          
          <p>I wanted to synchronize audio playback between different machines so I could
hear the same sound from speakers connected to all my machines in the house.
But before trying out external utilites, I decided to give it a try myself. I
primarily use <a href="https://mpv.io/">mpv-player</a> for everything multimedia. So, naturally I went on to tinker
if I could somehow synchronize playback on different devices with mpv.</p>
<p>I went ahead with my Laptop and Raspberry Pi and saw they have a pretty noticeable difference in startup times of mpv.
I thought if I could synchronize the startup times of mpv between machines, every other piece of the puzzle would
automatically fall into place, since there is probably no computation lag on my machines when decoding an audio
encoding to be played by the speaker in real-time. I synchronized my
device clocks from an external NTP server and launched mpv with the following params:</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>$ mpv https://www.youtube.com/watch?v=ixUWy9qdi08 --input-ipc-server=/tmp/mpvsocket --no-video --pause
</span></code></pre>
<p>I imagined this would workaround mpv's startup time, and once both are ready - I would instruct the
<a href="https://mpv.io/manual/stable/#json-ipc">IPC server</a> to unpause the mpv on both my Laptop and Raspberry Pi at the
same time. Boom! We would now have same audio being given off by both the devices. I installed
<a href="https://www.linuxjournal.com/content/schedule-one-time-commands-unix-tool"><code>at</code></a> tool which allows you to run a
command at a specific time. I added an entry to unpause mpv at a specific time on both devices. Something like this:</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>$ at 20:28
</span><span>at&gt; echo &#39;{ &quot;command&quot;: [&quot;set_property&quot;, &quot;pause&quot;, &quot;no&quot;] }&#39; | socat - /tmp/mpvsocket
</span><span>at&gt; &lt;EOT&gt;
</span><span>job 1 at Mon Apr  1 20:28:00 2019
</span></code></pre>
<p>I tested this but for some reason I would usually end up with reasonable gap between the audio like 1 second or so -
enough for any human ear to detect the out-of-sync audio. I suspect this gap might occur from several reasons, <code>at</code>
command only checks at a gap of every second to see if there is any job. Let's say <code>at</code> previously checked at 20:27:59
and 900 milliseconds. The next time it checks for a pending job might be on 20:28:00 and 900 milliseconds. We're
already late by 900 milliseconds. I'm not sure whether this is the case but it could take some investigation.
Second reason might probably be because of the small delays that occur on the Raspberry Pi when executing <code>at</code> and
writing the data with <code>socat</code> to mpv's IPC server. The last one would be as simple as the clocks of the two machines
are not really synchronized in the order of milliseconds. Or a combination of these. Anyway, I couldn't get it to
work reliably with this approach.</p>
<p>So I gave up, and a bit of looking up on the Internet for external utilities. I tried out one such software mentioned -
<a href="https://github.com/Syncplay/syncplay/">Syncplay</a> which supports multiple players and mpv being one of them. <code>make</code>
went without problems. Although, I initially had trouble to get audio-only (since Syncplay is more tailored to video syncing)
output working on my headless Raspberry Pi,
but I found out you could pass additional parameters to the player and disabled the video output (I also created an issue
<a href="https://github.com/Syncplay/syncplay/issues/229">#229</a>):</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>$ syncplay --no-gui -a syncplay.pl -r randomroom --player-path mpv https://www.youtube.com/watch?v=ixUWy9qdi08 -- --no-video --vo=null
</span></code></pre>
<p>On my laptop, I launched the same command without any additional parameters to the player:</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>$ syncplay --no-gui -a syncplay.pl -r randomroom --player-path mpv https://www.youtube.com/watch?v=ixUWy9qdi08
</span></code></pre>
<p>This resulted in mpv running in pseudo GUI mode on my laptop and I could control the player with it (seek, un/pause).
Adjusting the playback so would also cause similar changes to the syncplay client instance running on my Pi. It seems
to work pretty well but can sometimes the audio may get out-of-sync. I found that seeking backwards/forwards a bit can
help eliminate out-of-sync issues. Syncplay, however, does not seem whether it is intended for such a purpose (of syncing
audio between machines). Its main purpose (as on their GitHub page) seems to mainly focus on video playing so that viewers
can watch the same thing at the same time, as it states:</p>
<blockquote>
<p>Solution to synchronize video playback across multiple instances of mpv, VLC, MPC-HC, MPC-BE and mplayer2 over the
Internet.</p>
</blockquote>
<p>Like with most command-line software I find cool, I tried to get Syncplay running on my Android with Termux. However, mpv isn't
compiled with Lua support when installed with <code>pkg</code> on Termux and I didn't want to go through the trouble of
setting up the toolchain to compile it for Android. Turns out, I just needed to disable loading the Lua script
as in <a href="https://github.com/ritiek/syncplay/tree/mpv-without-lua-support">https://github.com/ritiek/syncplay/tree/mpv-without-lua-support</a>
and somehow everything turned out to be fine!</p>
<p>Either way, I'll keep Syncplay.</p>
<p>I still haven't dug in the Syncplay codebase deep enough to understand how everything works yet. It might be
a fun thing to do so in my spare time.</p>
<p>I also found out <a href="https://github.com/badaix/snapcast">Snapcast</a> (especially tailored to sync audio) to work pretty well
might like it even more than Syncplay for audio syncing purposes! Although, I'll still stick to Syncplay for anything video
syncing.
I've done a revised section on syncing audio playback in <a href="/2023/06/11/capturing-and-piping-audio-output-from-a-process-in-linux/">this post</a>.</p>

        </article>
      </div>
    </div>
  </div>
</div>


  
    
<footer class="footer text-muted">
	<div class="container">
		<div class="row">
			<div class="col-lg-8 order-last order-lg-first">
				<ul class="list-inline">
					
						<li class="list-inline-item">Powered by <a href="https://www.getzola.org/">Zola</a></li>
					
				</ul>
			</div>
			<div class="col-lg-8 order-first order-lg-last text-lg-end">
				<ul class="list-inline">
					
				</ul>
			</div>
		</div>
	</div>
</footer>

  

  
<script type="text/javascript" src="https://ritiek.github.io/js/main.js" defer></script>

  <script type="text/javascript" src="https://ritiek.github.io/plugins/elasticlunr.min.js"></script>
  <script type="text/javascript">
    console.log("Loading search index...");
    fetch("https://ritiek.github.io/search_index.en.json")
      .then(response => {
        console.log("Search index response:", response.status);
        if (!response.ok) {
          throw new Error('Search index not found');
        }
        return response.json();
      })
      .then(data => { 
        console.log("Search index loaded successfully");
        window.searchIndex = data;
        var script = document.createElement('script');
        script.src = "https://ritiek.github.io/js/search.js";
        document.body.appendChild(script);
      })
      .catch(error => {
        console.error("Error loading search index:", error);
      });
  </script>

  
</body>
</html>
